<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="utf-8"/>
    <link layout:href="@{/css/styles.css}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }

        h1 {
            text-align: center;
            color: #343a40;
            margin-top: 20px;
        }

        .section-title {
            cursor: pointer;
            color: #007bff;
            font-weight: bold;
            margin-top: 10px;
        }

        .section-title:hover {
            text-decoration: underline;
        }

        .module-title {
            cursor: pointer;
            color: #007bff;
            font-weight: bold;
        }

        .module-title:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body id="page-top" layout:fragment="body">
<div>
    <h1>Course Details</h1>
    <p>Course Name: <span th:text="${courseDetails.fullname}"></span></p>

    <h2>Sections</h2>
    <div th:each="section : ${courseDetails.sections}">
        <p class="section-title" th:text="${section.name}"
           th:onclick="'toggleSectionContent(' + ${section.name.hashCode()} + ')'"></p>

        <div class="section-content" th:id="'section-content-' + ${section.name.hashCode()}" style="display:none;">
            <ul>
                <li th:each="module : ${section.moduless}">
                    <p class="module-title"
                       th:text="${module.name}"
                       th:data-module-id="${module.id}"
                       th:data-module-type="${module.moduleType}"
                       th:data-course-id="${courseDetails.moodleCourseId}"
                       onclick="redirectToModulePage(this)"></p>
                </li>

            </ul>
        </div>
    </div>
</div>

<script>
    // Function to toggle the visibility of a section's content
    function toggleSectionContent(sectionId) {
        var sectionContent = document.getElementById("section-content-" + sectionId);
        if (sectionContent.style.display === "none") {
            sectionContent.style.display = "block"; // Show section content
        } else {
            sectionContent.style.display = "none"; // Hide section content
        }
    }

    // Function to submit the module form using POST method
    function redirectToModulePage(element) {
        const moduleId = element.getAttribute("data-module-id");
        const moduleType = element.getAttribute("data-module-type");
        const moodleCourseId = element.getAttribute("data-course-id");

        // In ra thông tin kiểm tra moduleId, moduleType và moodleCourseId
        console.log("Module ID: " + moduleId);
        console.log("Module Type: " + moduleType);
        console.log("Moodle Course ID: " + moodleCourseId);

        // Tạo form POST và thêm dữ liệu vào
        const form = document.createElement('form');
        form.method = 'POST'; // Sử dụng phương thức POST
        form.action = '/user/fetch_module_content'; // Đường dẫn tới @PostMapping trong controller

        // Thêm trường moduleId vào form
        const moduleIdInput = document.createElement('input');
        moduleIdInput.type = 'hidden';
        moduleIdInput.name = 'moduleId';
        moduleIdInput.value = moduleId;
        form.appendChild(moduleIdInput);

        // Thêm trường moduleType vào form
        const moduleTypeInput = document.createElement('input');
        moduleTypeInput.type = 'hidden';
        moduleTypeInput.name = 'moduleType';
        moduleTypeInput.value = moduleType;
        form.appendChild(moduleTypeInput);

        // Thêm trường moodleCourseId vào form
        const moodleCourseIdInput = document.createElement('input');
        moodleCourseIdInput.type = 'hidden';
        moodleCourseIdInput.name = 'moodleCourseId';
        moodleCourseIdInput.value = moodleCourseId;
        form.appendChild(moodleCourseIdInput);

        // Thêm form vào trang và gửi yêu cầu
        document.body.appendChild(form);
        form.submit(); // Gửi yêu cầu POST
    }



</script>

</body>
</html>
